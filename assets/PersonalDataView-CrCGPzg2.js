import{_ as b,r,o as x,a as R,c,g as w,d as s,L,t as u,H as P,I as S,A,i as p,j as _,k as f,M as D,l as V,v as d,e as B}from"./index-BAJinqMD.js";import{S as v}from"./sweetalert2.esm.all-BQxta0Da.js";const $={key:0,class:"profile-container"},I={class:"profile-card"},M={class:"profile-content"},j={class:"avatar-section"},E={class:"avatar-upload-label"},Q=["disabled"],T={class:"avatar-wrapper"},z=["src"],F={key:0,class:"avatar-loading"},H={class:"info-section"},O={key:0,class:"name-display"},q={key:1,class:"name-edit"},G={class:"edit-actions"},J={class:"uid-text"},K={class:"stats-grid"},W={class:"stat-item"},X={class:"stat-value"},Y={class:"stat-item"},Z={class:"stat-value"},ss="dn6r2yt4y",as="avatar",es={__name:"personalData",setup(C){const e=r({displayName:"",photoURL:"",totalCollections:0,createdAt:null}),n=r(!1),l=r(""),m=r(!0),i=r(!1),U=async o=>{const a=o.target.files[0];if(!a)return;i.value=!0;const t=new FormData;t.append("file",a),t.append("upload_preset",as);try{const y=await(await fetch(`https://api.cloudinary.com/v1_1/${ss}/image/upload`,{method:"POST",body:t})).json();if(y.secure_url){const g=y.secure_url,N=_(f,"users",p.currentUser.uid);await D(N,{photoURL:g}),e.value.photoURL=g,v.fire({icon:"success",title:"頭貼更新成功！",timer:1500,showConfirmButton:!1})}}catch(h){console.error(h),v.fire({icon:"error",title:"頭貼上傳失敗 Q_Q"})}finally{i.value=!1}};x(()=>{R(p,async o=>{if(o){const a=_(f,"users",o.uid),t=await V(a);t.exists()&&(e.value=t.data(),l.value=e.value.displayName),m.value=!1}})});const k=async()=>{if(l.value.trim())try{const o=_(f,"users",p.currentUser.uid);await D(o,{displayName:l.value}),e.value.displayName=l.value,n.value=!1,v.fire({icon:"success",title:"修改成功！",timer:1500,showConfirmButton:!1})}catch{v.fire({icon:"error",title:"更新失敗"})}};return(o,a)=>m.value?w("",!0):(d(),c("div",$,[s("div",I,[a[8]||(a[8]=s("div",{class:"card-header"},null,-1)),s("div",M,[s("div",j,[s("label",E,[s("input",{type:"file",onChange:U,hidden:"",accept:"image/*",disabled:i.value},null,40,Q),s("div",T,[s("img",{src:e.value.photoURL,class:L(["profile-avatar",{uploading:i.value}])},null,10,z),a[4]||(a[4]=s("div",{class:"avatar-hover-overlay"},[s("i",{class:"fa-solid fa-camera"}),s("span",null,"更換頭貼")],-1)),i.value?(d(),c("div",F,[...a[3]||(a[3]=[s("div",{class:"spinner"},null,-1)])])):w("",!0)])])]),s("div",H,[n.value?(d(),c("div",q,[P(s("input",{"onUpdate:modelValue":a[1]||(a[1]=t=>l.value=t),class:"edit-input",maxlength:"12"},null,512),[[S,l.value]]),s("div",G,[s("button",{onClick:k,class:"save-btn"},"儲存"),s("button",{onClick:a[2]||(a[2]=t=>n.value=!1),class:"cancel-btn"},"取消")])])):(d(),c("div",O,[s("h1",null,u(e.value.displayName),1),s("button",{onClick:a[0]||(a[0]=t=>n.value=!0),class:"edit-btn"},[...a[5]||(a[5]=[s("i",{class:"fa-solid fa-pen"},null,-1)])])])),s("p",J,"ID: "+u(A(p).currentUser.uid),1)]),s("div",K,[s("div",W,[s("span",X,u(e.value.totalCollections),1),a[6]||(a[6]=s("span",{class:"stat-label"},"總收藏筆數",-1))]),s("div",Y,[s("span",Z,u(e.value.createdAt?.toDate?new Date(e.value.createdAt.toDate()).toLocaleDateString():"尚未記錄"),1),a[7]||(a[7]=s("span",{class:"stat-label"},"加入日期",-1))])])])])]))}},ts=b(es,[["__scopeId","data-v-307c1e91"]]),os={class:"page"},ls={__name:"PersonalDataView",setup(C){return(e,n)=>(d(),c("div",os,[B(ts)]))}},rs=b(ls,[["__scopeId","data-v-a1d1b992"]]);export{rs as default};
