import{_ as B,r as s,c as p,d as t,G as N,g as _,H as n,I as w,x as y,J as g,F as S,h as T,t as I,i as U,j as F,k as C,m as L,K as O,u as A,v as c,L as Q,e as P}from"./index-DwGKJGD2.js";import{S as u}from"./sweetalert2.esm.all-BQxta0Da.js";const j={class:"container"},z={class:"main-content"},E={class:"image-section"},G={key:0,class:"upload-placeholder"},H={key:1,class:"loading-overlay"},J={key:2,class:"hover-overlay"},K={class:"info-section"},q={class:"form-group"},W={class:"form-group"},X={class:"radio-group"},Y={class:"form-group"},Z={class:"radio-group"},ee={class:"form-group rating-row"},te={class:"star-group"},le=["onClick","onMouseover"],oe={class:"comment-section"},ae=["disabled"],se="dn6r2yt4y",ne="Favory",ie={__name:"addFavory",setup($){const V=A(),k=s(!1),d=s(""),i=s(""),o=s(""),m=s(""),b=s(0),x=s(""),v=s(!1),M=async r=>{const e=r.target.files[0];if(!e)return;v.value=!0;const l=new FormData;l.append("file",e),l.append("upload_preset",ne);try{const f=await(await fetch(`https://api.cloudinary.com/v1_1/${se}/image/upload`,{method:"POST",body:l})).json();f.secure_url&&(i.value=f.secure_url)}catch{alert("圖片傳送失敗 Q_Q")}finally{v.value=!1}},R=async()=>{if(!d.value)return u.fire({icon:"warning",title:"哎呀！",text:"請輸入名稱喔！",confirmButtonColor:"#6366f1"});if(!i.value)return u.fire({icon:"warning",title:"圖片在哪呢？",text:"請挑選一張圖片吧！",confirmButtonColor:"#6366f1"});if(!U.currentUser)return u.fire({icon:"error",title:"權限不足",text:"登入後才能收藏喔！",confirmButtonColor:"#6366f1"});u.fire({title:"儲存並更新數據中...",allowOutsideClick:!1,didOpen:()=>{u.showLoading()}});const r=U.currentUser.uid,e=F(C,"users",r),l=L(C,"myFavoryList");try{await O(C,async a=>{const f=await a.get(e);if(!f.exists())throw"使用者文件不存在！";const h=(f.data().totalCollections||0)+1,D=F(l);a.set(D,{name:d.value,image:i.value,category:o.value,status:m.value,rating:b.value,comment:x.value,uid:r,createdAt:new Date}),a.update(e,{totalCollections:h})}),u.fire({icon:"success",title:"成功加入收藏！",text:`《${d.value}》已經入庫囉！`,timer:2e3,showConfirmButton:!1,timerProgressBar:!0}),d.value="",i.value="",x.value="",o.value="",b.value=0,k.value=!1,V.push("/Myhome/List")}catch(a){console.error("儲存失敗:",a),u.fire({icon:"error",title:"Oops...",text:"儲存失敗或更新計數出錯，請再試一次 Q_Q"})}};return(r,e)=>(c(),p("div",j,[t("div",z,[t("div",E,[t("label",{class:"upload-box",style:N({backgroundImage:`url(${i.value})`})},[t("input",{type:"file",onChange:M,hidden:"",accept:"image/*"},null,32),!i.value&&!v.value?(c(),p("div",G,[...e[9]||(e[9]=[t("span",null,"+ 點擊上傳封面",-1)])])):_("",!0),v.value?(c(),p("div",H,"上傳中...")):_("",!0),i.value?(c(),p("div",J,[...e[10]||(e[10]=[t("span",null,"更換圖片",-1)])])):_("",!0)],4)]),t("div",K,[t("div",q,[e[11]||(e[11]=t("label",{class:"label-text"},"作品名稱",-1)),n(t("input",{style:{"max-width":"90%"},"onUpdate:modelValue":e[0]||(e[0]=l=>d.value=l),type:"text",placeholder:"請輸入名稱...",class:"input-text"},null,512),[[w,d.value]])]),t("div",W,[e[14]||(e[14]=t("label",{class:"label-text"},"狀態",-1)),t("div",X,[t("label",null,[n(t("input",{type:"radio","onUpdate:modelValue":e[1]||(e[1]=l=>m.value=l),value:"完結",hidden:""},null,512),[[g,m.value]]),e[12]||(e[12]=y(" 完結",-1))]),t("label",null,[n(t("input",{type:"radio","onUpdate:modelValue":e[2]||(e[2]=l=>m.value=l),value:"未完結",hidden:""},null,512),[[g,m.value]]),e[13]||(e[13]=y(" 未完結",-1))])])]),t("div",Y,[e[18]||(e[18]=t("label",{class:"label-text"},"分類",-1)),t("div",Z,[t("label",null,[n(t("input",{type:"radio","onUpdate:modelValue":e[3]||(e[3]=l=>o.value=l),value:"漫畫",hidden:""},null,512),[[g,o.value]]),e[15]||(e[15]=y(" 漫畫",-1))]),t("label",null,[n(t("input",{type:"radio","onUpdate:modelValue":e[4]||(e[4]=l=>o.value=l),value:"動漫",hidden:""},null,512),[[g,o.value]]),e[16]||(e[16]=y(" 動漫",-1))]),t("label",null,[n(t("input",{type:"radio","onUpdate:modelValue":e[5]||(e[5]=l=>o.value=l),value:"電影",hidden:""},null,512),[[g,o.value]]),e[17]||(e[17]=y(" 電影",-1))]),n(t("input",{type:"text","onUpdate:modelValue":e[6]||(e[6]=l=>o.value=l),placeholder:"其他",class:"input-inline"},null,512),[[w,o.value]])])]),t("div",ee,[e[19]||(e[19]=t("label",null,[t("label",{class:"label-text"},"評分")],-1)),t("div",te,[(c(),p(S,null,T(5,l=>t("span",{key:l,class:Q(["star-item",{active:l<=b.value}]),onClick:a=>b.value=l,onMouseover:a=>r.hoverRating=l,onMouseleave:e[7]||(e[7]=a=>r.hoverRating=0)}," ★ ",42,le)),64))])])])]),t("div",oe,[e[20]||(e[20]=t("label",{class:"label-text"},"評論",-1)),n(t("textarea",{"onUpdate:modelValue":e[8]||(e[8]=l=>x.value=l),placeholder:"寫點什麼吧..."},null,512),[[w,x.value]]),t("button",{onClick:R,disabled:v.value,class:"submit-btn"},I(v.value?"上傳中...":"確認收藏"),9,ae)])]))}},re=B(ie,[["__scopeId","data-v-201f9a37"]]),ue={class:"page"},de={__name:"AddFavoryView",setup($){return(V,k)=>(c(),p("div",ue,[P(re)]))}},ce=B(de,[["__scopeId","data-v-08ad2f3f"]]);export{ce as default};
